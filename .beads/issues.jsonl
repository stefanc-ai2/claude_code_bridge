{"id":"claude_code_bridge-zjc","title":"Robustness: eliminate hangs, stale state, and lock races","description":"Epic for CCB robustness improvements.\n\n## Scope\n1. RPC timeouts + deadline propagation (Critical)\n2. Atomic state writes + validation helper (Critical)\n3. Lock robustness - TOCTOU, FD leaks (Critical)\n4. Stale state detection - TTL, pid checks (High)\n5. Replace bare exception handlers (High)\n\n## Success Criteria\n- No socket operations can hang indefinitely\n- State file writes are atomic and validated\n- Lock acquisition is race-free\n- Stale sessions are detected and cleaned up\n- Exceptions are typed and debuggable","status":"open","priority":1,"issue_type":"epic","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:00:55.030591-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:00:55.030591-08:00","labels":["robustness"]}
{"id":"claude_code_bridge-zjc.1","title":"RPC: add per-recv timeouts + request deadlines","description":"Add hard timeouts to all RPC/socket I/O to prevent indefinite hangs.\n\n## Files\n- lib/askd_client.py\n- lib/askd_rpc.py\n- bin/ask\n\n## Implementation\n- Add socket.settimeout() for all recv operations\n- Implement deadline propagation (pass timeout_s down call stack)\n- Wrap decode loops with deadline checks\n- Surface single timeout error type (CCBTimeoutError)\n\n## Acceptance Criteria\n- [ ] Every connect/send/recv has bounded timeout\n- [ ] Global request deadline prevents partial-read hangs\n- [ ] Consistent timeout error type surfaced to callers\n- [ ] Tests for timeout scenarios","status":"closed","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.590972-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:12:48.317422-08:00","closed_at":"2026-01-30T02:12:48.317424-08:00","labels":["quick-win","robustness","rpc"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.1","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.59182-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.2","title":"State: atomic writes + JSON validation helper","description":"Make session/state writes atomic and add validation.\n\n## Files\n- lib/session_utils.py\n- lib/pane_registry.py\n- daemon state writers\n\n## Implementation\n- Standardize: temp file → fsync → os.replace → chmod(0o600)\n- Create read_json_state(path, schema=None) helper\n- Add minimal schema validation for required keys/types\n- Replace scattered json.loads() with validated reads\n\n## Acceptance Criteria\n- [ ] All state writes use atomic pattern\n- [ ] Validation helper with schema support\n- [ ] File permissions hardened (0o600)\n- [ ] Tests for concurrent write scenarios","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.779267-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:14.779267-08:00","labels":["quick-win","robustness","state"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.2","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.779771-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.3","title":"Locks: fix TOCTOU + FD leaks; add contention tests","description":"Eliminate TOCTOU races and FD leaks in lock implementation.\n\n## Files\n- lib/process_lock.py\n\n## Implementation\n- Use single open FD with O_CLOEXEC, always closed on retry/failure\n- Rely on OS primitives (exclusive create / flock) not check-then-create\n- Add contention tests: multiple processes competing for same lock\n\n## Acceptance Criteria\n- [ ] No TOCTOU window in lock acquisition\n- [ ] No FD leaks on retry/failure paths\n- [ ] Tests: one winner, no leaked FDs, bounded wait, cleanup on crash\n- [ ] Works correctly on Windows and Unix","status":"open","priority":1,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:14.976308-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:14.976308-08:00","labels":["locks","refactor","robustness"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.3","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:14.976845-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.4","title":"Registry: stale detection (TTL, pid checks, self-heal)","description":"Add stale state detection and isolation tightening.\n\n## Files\n- lib/pane_registry.py\n- lib/claude_comm.py\n- state readers\n\n## Implementation\n- Add owner identity fields: created_at, last_seen_at, pid, instance token\n- Verify pid is alive on read (best-effort)\n- Check timestamps within TTL, project key matches normalized workdir\n- Provide --cleanup and self-heal paths\n\n## Acceptance Criteria\n- [ ] Stale sessions detected by TTL and pid checks\n- [ ] Invalid/stale state ignored and regenerated\n- [ ] Self-heal path for corrupted state\n- [ ] Tests for stale state scenarios","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:29.98364-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:29.98364-08:00","labels":["registry","robustness","state"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.4","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:29.984208-08:00","created_by":"stefanc-ai2"},{"issue_id":"claude_code_bridge-zjc.4","depends_on_id":"claude_code_bridge-zjc.2","type":"blocked-by","created_at":"2026-01-30T02:01:29.985189-08:00","created_by":"stefanc-ai2"}]}
{"id":"claude_code_bridge-zjc.5","title":"Errors: replace bare excepts; add debug diagnostics","description":"Systematically replace bare exception handlers with typed handling.\n\n## Scope\n~352 bare except handlers across ~42 files\n\n## Implementation\n- Triage into categories: file I/O, JSON parsing, subprocess, sockets\n- Replace with narrow exception types\n- When CCB_DEBUG=1, emit structured diagnostics to stderr/log\n- Make recovery behavior intentional and debuggable\n\n## Acceptance Criteria\n- [ ] No bare except: or except Exception: without justification\n- [ ] CCB_DEBUG=1 shows structured error info\n- [ ] Recovery behavior is explicit and documented\n- [ ] Tests for error recovery paths","status":"open","priority":2,"issue_type":"task","owner":"stefanc@allenai.org","created_at":"2026-01-30T02:01:30.174492-08:00","created_by":"stefanc-ai2","updated_at":"2026-01-30T02:01:30.174492-08:00","labels":["errors","observability","refactor","robustness"],"dependencies":[{"issue_id":"claude_code_bridge-zjc.5","depends_on_id":"claude_code_bridge-zjc","type":"parent-child","created_at":"2026-01-30T02:01:30.175038-08:00","created_by":"stefanc-ai2"}]}
